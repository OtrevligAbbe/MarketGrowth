@using System.Globalization
@using System.Linq
@using Microsoft.AspNetCore.Components

<svg width="80" height="24" viewBox="0 0 80 24" preserveAspectRatio="none" class="mg-sparkline">
    @if (PointsAttribute is not null)
    {
        <polyline
            points="@PointsAttribute"
            fill="none"
            stroke="@StrokeColor"
            stroke-width="2" />
    }
</svg>

@code {
    [Parameter] public IReadOnlyList<decimal>? Data { get; set; }


    [Parameter] public bool IsPositive { get; set; }

    private string StrokeColor => IsPositive ? "#00FF88" : "#FF4D4D";

    private string? PointsAttribute => BuildPoints();

    private string? BuildPoints()
    {
        if (Data is null || Data.Count == 0)
            return null;

        var count = Data.Count;
        if (count == 1)
        {
            return "0,12 80,12";
        }

        var min = Data.Min();
        var max = Data.Max();
        var range = max - min;
        if (range == 0) range = 1;

        var points = new List<string>();

        for (int i = 0; i < count; i++)
        {
            var x = (double)i / (count - 1) * 80.0;

            var value = (double)((Data[i] - min) / range);

            var y = 24.0 - value * 24.0;

            points.Add(
                $"{x.ToString("0.##", CultureInfo.InvariantCulture)}," +
                $"{y.ToString("0.##", CultureInfo.InvariantCulture)}");
        }

        return string.Join(" ", points);
    }
}
