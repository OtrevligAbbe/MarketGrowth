@page "/marketdata"
@using frontend.Shared
@inject HttpClient Http

<h1>Live Crypto Market</h1>

@if (_prices == null && _errorMessage == null)
{
    <p>Laddar live-data...</p>
}
else if (_errorMessage != null)
{
    <p style="color: red">@_errorMessage</p>
}
else
{
    <div class="market-grid">
        @foreach (var kvp in _prices)
        {
            var coin = kvp.Value;

            <div class="market-card">
                <div class="market-name">@coin.Symbol</div>

                <div class="market-price">
                    $@coin.PriceUsd.ToString("N2")
                </div>

                <div class="market-change @(coin.Change24h >= 0 ? "market-positive" : "market-negative")">
                    @coin.Change24h.ToString("0.00") %
                </div>
            </div>
        }
    </div>
}

@code {
    // Dictionary<string, MarketPrice> eftersom JSON:et är ett objekt med nycklar BTC, ETH, osv
    private Dictionary<string, MarketPrice>? _prices;
    private string? _errorMessage;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            // VIKTIGT: relativ URL – INTE localhost
            _prices = await Http.GetFromJsonAsync<Dictionary<string, MarketPrice>>(
                "api/market/crypto"
            );
        }
        catch (Exception ex)
        {
            _errorMessage = $"Kunde inte hämta data: {ex.Message}";
        }
    }
}
